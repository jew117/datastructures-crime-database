-- DB
CREATE DATABASE IF NOT EXISTS crime_analytics_akron;
SHOW DATABASES;
USE crime_analytics_akron;
SELECT DATABASE();


-- INCIDENTS (APD + UAPD)
CREATE TABLE IF NOT EXISTS incidents (
  incident_id        BIGINT AUTO_INCREMENT PRIMARY KEY,
  report_number      VARCHAR(32) NOT NULL,
  department_code    ENUM('APD','UAPD') NOT NULL,
  
  incident_datetime  DATETIME NOT NULL,    
  reported_datetime  DATETIME NOT NULL,    
  crime_type         VARCHAR(120) NOT NULL,
  location           VARCHAR(255) NOT NULL,
  is_closed          BOOLEAN NOT NULL DEFAULT 0,
  resolution         VARCHAR(255) NULL,
  
  address_number     VARCHAR(16) NULL,
  street_name        VARCHAR(128) NULL,
  akron_district     VARCHAR(32) NULL,
  source_url         VARCHAR(500) NULL,
  latitude           DECIMAL(9,6) NULL,
  longitude          DECIMAL(9,6) NULL,

  created_at         DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at         DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
                                  ON UPDATE CURRENT_TIMESTAMP,

  CONSTRAINT uniq_dept_report UNIQUE (department_code, report_number),
  CONSTRAINT chk_reported_after_incident CHECK (reported_datetime >= incident_datetime),
  CONSTRAINT chk_lat CHECK (latitude  IS NULL OR (latitude  BETWEEN -90  AND 90)),
  CONSTRAINT chk_lon CHECK (longitude IS NULL OR (longitude BETWEEN -180 AND 180))
) ENGINE=InnoDB;

ALTER TABLE incidents
  DROP COLUMN address_number,
  DROP COLUMN street_name,
  DROP COLUMN akron_district,
  DROP COLUMN source_url,
  DROP COLUMN latitude,
  DROP COLUMN longitude;


-- Create indexes (MySQL syntax)
CREATE INDEX idx_incidents_datetime ON incidents (incident_datetime);
CREATE INDEX idx_incidents_dept     ON incidents (department_code);
CREATE INDEX idx_incidents_street   ON incidents (street_name);

SHOW TABLES;

USE crime_analytics_akron;



-- SQL Queries
SELECT * FROM incidents;

INSERT INTO incidents 
  (department_code, report_number, incident_datetime, reported_datetime, crime_type, location, is_closed)
VALUES 
  ('APD', '2025-00009999', '2025-09-25 14:30:00', '2025-09-25 14:35:00', 'Theft/Larceny', '224 MAIN ST, Akron, OH, 44308', 0);

SELECT *
From incidents 
Where report_number = '2025-00009999'

UPDATE incidents
SET 
  crime_type = 'Burglary',
  is_closed = 1,
  resolution = 'Case Closed â€“ Suspect Arrested',
  updated_at = CURRENT_TIMESTAMP()
WHERE 
  department_code = 'APD'
  AND report_number = '2025-00009999';

SELECT *
From incidents 
Where report_number = '2025-00009999'

DELETE FROM incidents
WHERE 
  department_code = 'APD'
  AND report_number = '2025-00009999';


SELECT *
From incidents 
Where report_number = '2025-00009999'

