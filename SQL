-- DB
CREATE DATABASE IF NOT EXISTS crime_analytics_akron;
SHOW DATABASES;
USE crime_analytics_akron;
SELECT DATABASE();


-- INCIDENTS (APD + UAPD)
CREATE TABLE IF NOT EXISTS incidents (
  incident_id        BIGINT AUTO_INCREMENT PRIMARY KEY,
  department_code    ENUM('APD','UAPD') NOT NULL,
  report_number      VARCHAR(32) NOT NULL,
  incident_datetime  DATETIME NOT NULL,    -- store UTC
  reported_datetime  DATETIME NOT NULL,    -- if unknown, copy incident_datetime
  crime_type         VARCHAR(120) NOT NULL,
  location           VARCHAR(255) NOT NULL,

  address_number     VARCHAR(16) NULL,
  street_name        VARCHAR(128) NULL,
  akron_district     VARCHAR(32) NULL,
  source_url         VARCHAR(500) NULL,
  latitude           DECIMAL(9,6) NULL,
  longitude          DECIMAL(9,6) NULL,

  is_closed          BOOLEAN NOT NULL DEFAULT 0,
  resolution         VARCHAR(255) NULL,

  created_at         DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at         DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
                                  ON UPDATE CURRENT_TIMESTAMP,

  CONSTRAINT uniq_dept_report UNIQUE (department_code, report_number),
  CONSTRAINT chk_reported_after_incident CHECK (reported_datetime >= incident_datetime),
  CONSTRAINT chk_lat CHECK (latitude  IS NULL OR (latitude  BETWEEN -90  AND 90)),
  CONSTRAINT chk_lon CHECK (longitude IS NULL OR (longitude BETWEEN -180 AND 180))
) ENGINE=InnoDB;


-- Create indexes (MySQL syntax)
CREATE INDEX idx_incidents_datetime ON incidents (incident_datetime);
CREATE INDEX idx_incidents_dept     ON incidents (department_code);
CREATE INDEX idx_incidents_street   ON incidents (street_name);

SHOW TABLES;
